{"creationTimeStamp":"2022-10-27T13:04:04.006Z","modifiedTimeStamp":"2022-10-27T13:13:12.815Z","createdBy":"Sundaresh.Sankaran@sas.com","modifiedBy":"Sundaresh.Sankaran@sas.com","name":"SDG - Generate Correlation Plot Comparison.step","displayName":"SDG - Generate Correlation Plot Comparison.step","localDisplayName":"SDG - Generate Correlation Plot Comparison.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/841d4fcc-f8be-4c77-894c-dd88673763c1","uri":"/dataFlows/steps/841d4fcc-f8be-4c77-894c-dd88673763c1","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/841d4fcc-f8be-4c77-894c-dd88673763c1","uri":"/dataFlows/steps/841d4fcc-f8be-4c77-894c-dd88673763c1","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/841d4fcc-f8be-4c77-894c-dd88673763c1","uri":"/dataFlows/steps/841d4fcc-f8be-4c77-894c-dd88673763c1","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/841d4fcc-f8be-4c77-894c-dd88673763c1","uri":"/dataFlows/steps/841d4fcc-f8be-4c77-894c-dd88673763c1"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/841d4fcc-f8be-4c77-894c-dd88673763c1","uri":"/dataFlows/steps/841d4fcc-f8be-4c77-894c-dd88673763c1","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/841d4fcc-f8be-4c77-894c-dd88673763c1","uri":"/dataFlows/steps/841d4fcc-f8be-4c77-894c-dd88673763c1","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"inputtable1","displayName":"inputtable1","localDisplayName":"inputtable1","minEntries":1,"maxEntries":1,"type":"table"},{"name":"inputtable2","displayName":"inputtable2","localDisplayName":"inputtable2","minEntries":1,"maxEntries":1,"type":"table"}],"outputPorts":[]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Correlation Plot\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"inputtable1\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Train Data\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"inputtable2\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Synthetic Data\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"columnselector1\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Select columns for correlation plot\",\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"n\",\n\t\t\t\t\t\"max\": null,\n\t\t\t\t\t\"min\": null,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"table\": \"inputtable2\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"page2\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text_description\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Generate Correlation Plot Comparison\\n\\nThe \\\"Generate Correlation Plot Comparison\\\" custom step generates correlation plots depicting correlations of selected variables for both original and synthetic data, so that users can understand if intra-dataset correlation in their synthetic data is adequately similar to that of the original. This step results in a chart printed in the Results Tab, accessible from the Submission window.  It also creates and loads an in-memory table which is available for reporting in Visual Analytics.  \\n\\nWhile the purpose of this custom step is to assist in synthetic data generation, users may choose to repurpose the same to compare intra-dataset correlations of any two tables with the same variables.  Just ensure that the dataset provided to the Synthetic Data input port has a TRAINFLAG set to 1. \\n\\nInput parameters for this custom step are : \\n\\n1. Attach a table containing the original training data to the Training Data input port.\\n2. Attach a table containing the synthetic data to the Synthetic Data input port\\n3. Select the columns you wish to generate correlation plots for.\\n\\nThere are no explicit output datasets created which are intended to be used further in the flow.  However,  you'll notice that your CASUSER caslib will now contain a table (synthetic_data_corr_plot)  which is also loaded to memory.  You may choose to visualize this using SAS Visual Analytics.\\n\\nCreated / contact : Brett Wujek (brett.wujek@sas.com),  Reza Nazari (reza.nazari@sas.com) , Ruiwen Zhang (ruiwen.zhang@sas.com) and Sundaresh Sankaran (sundaresh.sankaran@sas.com) \\n\\nVersion : 1.0.   (06OCT2022)\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"inputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"inputtable2\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"columnselector1\": []\n\t}\n}","templates":{"SAS":"\n%let blankSeparatedList = %_flw_get_column_list(_flw_prefix=columnselector1);\n%let commaSeparatedList = %_flw_get_column_list(_flw_prefix=columnselector1, _delim=%str(,));\n\ndata _null_;\n\tcall symput(\"commaSeparatedList\",'\"'||tranwrd(\"&commaSeparatedList.\",\",\",'\",\"')||'\"');\nrun;\n\n%put &commaSeparatedList.;\n\n\nproc cas;\n   simple.correlation /\n      inputs={&commaSeparatedList.}\n\t  simple=true\n      table={name = \"&inputtable1_name_base.\", caslib=\"&inputtable1_lib.\"}\n\t  outPearson={name=\"train_corr_out1\", caslib=\"CASUSER\" ,replace=\"TRUE\"};\nrun;\n\n\nproc cas;\n   simple.correlation /\n      inputs={&commaSeparatedList.}  \n\t  simple=true\n      table={name = \"&inputtable2_name_base.\", caslib=\"&inputtable2_lib.\"}\n\t  outPearson={name=\"synth_corr_out1\", caslib=\"CASUSER\" ,replace=\"TRUE\"};\nrun;\n\n\ndata CASUSER.train_corr_out;\nset CASUSER.train_corr_out1;\n\tif _N_>3;\n\tdrop _TYPE_ ;\nrun;\n\ndata CASUSER.synth_corr_out;\nset CASUSER.synth_corr_out1;\n\tif _N_>3;\n\tdrop _TYPE_ ;\nrun;\n\n\n  /* prep data for heat map */\ndata CASUSER.train_corr_plot;\n  keep x y r;\n  set CASUSER.train_corr_out;\n  array v{*} _numeric_;\n  x = _NAME_;\n  do i = dim(v) to 1 by -1;\n    y = vname(v(i));\n    r = v(i);\n    /* creates a lower triangular matrix */\n    if (i<_n_) then\n      r=.;\n    output;\n  end;\nrun;\n\n  /* prep data for heat map */\ndata CASUSER.synth_corr_plot;\n  keep x y r;\n  set CASUSER.synth_corr_out;\n  array v{*} _numeric_;\n  x = _NAME_;\n  do i = dim(v) to 1 by -1;\n    y = vname(v(i));\n    r = v(i);\n    /* creates a lower triangular matrix */\n    if (i<_n_) then\n      r=.;\n    output;\n  end;\nrun;\n\nproc template;\n  define statgraph corrHeatmap;\n   dynamic _Title;\n    begingraph;\n      entrytitle _Title;\n      rangeattrmap name='map';\n      /* select a series of colors that represent a \"diverging\"  */\n      /* range of values: stronger on the ends, weaker in middle */\n      /* Get ideas from http://colorbrewer.org                   */\n      range -1 - 1 / rangecolormodel=(cxD8B365 cxF5F5F5 cx5AB4AC);\n      endrangeattrmap;\n      rangeattrvar var=r attrvar=r attrmap='map';\n      layout overlay / \n        xaxisopts=(display=(line ticks tickvalues)) \n        yaxisopts=(display=(line ticks tickvalues));\n        heatmapparm x = x y = y colorresponse = r / \n          xbinaxis=false ybinaxis=false\n          name = \"heatmap\" display=all;\n        continuouslegend \"heatmap\" / \n          orient = vertical location = outside title=\"Pearson Correlation\";\n      endlayout;\n    endgraph;\n  end;\nrun;\n\n\nproc sgrender data=CASUSER.train_corr_plot template=corrHeatmap;\n   dynamic _title=\"Corr matrix for real data\";\nrun;\n\n\nproc sgrender data=CASUSER.synth_corr_plot template=corrHeatmap;\n   dynamic _title=\"Corr matrix for synthetic data\";\nrun;\n\n\ndata CASUSER.synthetic_data_corr_plot;\n\tlength Synthetic_data_flag varchar(*);\n\tset CASUSER.train_corr_plot(in=a) CASUSER.synth_corr_plot(in=b);\n\tIf b then Synthetic_data_flag=\"Generated Data\"; else Synthetic_data_flag=\"Original Data\";\nrun;\n\nproc cas;\n\ttable.save / \n\t\n\t\ttable= {name=\"synthetic_data_corr_plot\", caslib=\"CASUSER\"}\n\t\tname=\"synthetic_data_corr_plot\"\n\t\tcaslib=\"CASUSER\"\n\t\treplace=True\n\t;\n\t\n\ttable.tableExists  result=rc/\n\t   name=\"synthetic_data_corr_plot\", caslib=\"CASUSER\"\n\t;\n\tprint rc;\n\t\n\tdo until (rc.exists=0);\n\t   table.dropTable /\n\t         name=\"synthetic_data_corr_plot\"\n\t\t\t caslib=\"CASUSER\"\n\t         ;\n\t   table.tableExists  result=rc/\n\t\t\tname=\"synthetic_data_corr_plot\"\n\t\t\tcaslib=\"CASUSER\"\n\t\t\t;\n\tprint rc;\n\tend;\n\t\n\t;\n\t\n\ttable.loadTable /\n\t\tpath=\"synthetic_data_corr_plot.sashdat\"\n\t\tcaslib=\"CASUSER\"\n\t\tcasout={name=\"synthetic_data_corr_plot\", caslib=\"CASUSER\"}\n\t\n\t;\n\t\n\t;\n\t\ttable.promote /\n\t        name=\"synthetic_data_corr_plot\"\n\t        caslib=\"CASUSER\"\n\t        drop=FALSE\n\t        targetcaslib=\"CASUSER\"\n\t    ;\n\t\nquit;\n\n"}}